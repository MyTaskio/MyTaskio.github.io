<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Taskio - مدیریت کارها</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- فونت وزیرمتن و مونتسرات -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">

    <!-- آیکون تب مرورگر (Favicon) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%232196f3'/><path d='M30 50 L45 65 L70 35' stroke='white' stroke-width='10' fill='none'/></svg>">

    <!-- کتابخانه Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

    <div class="brand-logo">Taskio</div>

    <div class="container">
        <header>
            <div class="header-controls">
                <button id="theme-toggle" class="icon-btn"></button>
                
                <!-- منوی کاربر -->
                <div class="user-menu-container">
                    <button id="auth-btn" class="icon-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    </button>
                    <div id="user-dropdown" class="dropdown-menu">
                        <div id="dropdown-header" class="dropdown-header">کاربر مهمان</div>
                        <button id="edit-profile-btn" class="dropdown-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            ویرایش پروفایل
                        </button>
                        <button id="logout-btn" class="dropdown-item text-danger">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                            خروج
                        </button>
                    </div>
                </div>
            </div>
            <h1 id="header-title">لیست کارها</h1>
        </header>

        <div class="input-group">
            <input type="text" id="todo-input" placeholder="کار جدید..." autocomplete="off">
            <button id="add-btn">
                <!-- آیکون پلاس -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </button>
        </div>

        <ul id="todo-list"></ul>
    </div>

    <!-- مودال -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </span>
            
            <h2 id="modal-title">ورود به حساب</h2>

            <!-- ۱. بخش اصلی (ورود / ثبت نام / ویرایش) -->
            <div id="auth-main-section">
                <div id="signup-fields" style="display: none;">
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="fname-input" class="auth-input" placeholder="نام">
                        <input type="text" id="lname-input" class="auth-input" placeholder="نام خانوادگی">
                    </div>
                    <!-- ایمیل واقعی برای ثبت نام -->
                    <input type="email" id="real-email-input" class="auth-input ltr-input" placeholder="ایمیل (مثال: name@gmail.com)">
                </div>

                <!-- ایمیل یا نام کاربری (برای ورود) -->
                <input type="text" id="username-input" class="auth-input ltr-input" placeholder="نام کاربری یا ایمیل">
                
                <input type="password" id="password-input" class="auth-input ltr-input" placeholder="رمز عبور">

                <!-- لینک فراموشی رمز -->
                <div id="forgot-pass-container" style="text-align: right; margin-top: 5px; margin-bottom: 15px;">
                    <a href="#" id="forgot-pass-link" style="font-size: 0.8rem; color: var(--text-light); text-decoration: none;">رمز عبور را فراموش کردید؟</a>
                </div>

                <p id="auth-msg" class="error-msg"></p>
                
                <button id="submit-auth-btn">ورود</button>

                <div id="auth-footer-links" style="margin-top: 15px; font-size: 0.9rem; color: var(--text-light);">
                    <span id="switch-text">حساب ندارید؟</span>
                    <a href="#" id="switch-auth-btn" style="color: var(--primary); text-decoration: none; font-weight: bold;">ثبت نام</a>
                </div>
            </div>

            <!-- ۲. بخش فراموشی رمز (ایمیل گرفتن) -->
            <div id="recovery-section" style="display: none;">
                <p style="color: var(--text); font-size: 0.9rem; margin-bottom: 15px;">ایمیل خود را وارد کنید تا لینک تغییر رمز ارسال شود.</p>
                <input type="email" id="recovery-email-input" class="auth-input ltr-input" placeholder="ایمیل شما">
                <p id="recovery-msg" class="error-msg"></p>
                <button id="send-recovery-btn" style="width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer;">ارسال لینک</button>
                <button id="back-to-login-btn" style="width: 100%; background: transparent; color: var(--text-light); border: none; padding: 10px; margin-top: 5px; cursor: pointer;">بازگشت</button>
            </div>

            <!-- ۳. بخش تغییر رمز جدید (بعد از کلیک روی لینک ایمیل) -->
            <div id="update-pass-section" style="display: none;">
                <p style="color: var(--text); font-size: 0.9rem; margin-bottom: 15px;">رمز عبور جدید خود را وارد کنید.</p>
                <input type="password" id="new-password-input" class="auth-input ltr-input" placeholder="رمز عبور جدید">
                <p id="update-pass-msg" class="error-msg"></p>
                <button id="save-new-pass-btn" style="width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer;">ذخیره رمز جدید</button>
            </div>

        </div>
    </div>

    <!-- مودال هشدار -->
    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <h3 id="alert-title">پیام</h3>
            <p id="alert-msg">متن پیام</p>
            <div class="alert-buttons">
                <button id="alert-ok-btn">باشه</button>
                <button id="alert-cancel-btn" style="display:none; background: var(--bg); color: var(--text);">انصراف</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
